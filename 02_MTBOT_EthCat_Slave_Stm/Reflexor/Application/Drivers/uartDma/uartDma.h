/**
 * @file uartDma.h
 *
 * TODO: Comment.
 */
#ifndef UARTDMA_H_
#define UARTDMA_H_

/*---------------------------------------------------------------------------------------------------------------------
 *                                                 INCLUDES
 *-------------------------------------------------------------------------------------------------------------------*/

#include <stdbool.h>
#include "usart.h"
#include "lwrb/lwrb.h"

/*---------------------------------------------------------------------------------------------------------------------
 *                                                 DEFINES
 *-------------------------------------------------------------------------------------------------------------------*/

#define UARTDMA_USE_TX_DMA          (1)

/*---------------------------------------------------------------------------------------------------------------------
 *                                             GLOBAL VARIABLES
 *-------------------------------------------------------------------------------------------------------------------*/

/*---------------------------------------------------------------------------------------------------------------------
 *                                               TYPES DEFINE
 *-------------------------------------------------------------------------------------------------------------------*/

/**
 * @brief The data structure of this module.
 */
typedef struct
{
   UART_HandleTypeDef * const huart;                  /**< Pointer of HAL Uart module. */
   lwrb_t                     tx_buff;                /**< The ring buffer for uart tx. */
   uint8_t * const            p_tx_buff_data;         /**< The pointer to the buffer contains all the data used for 
                                                           transfer data to uart tx.   */
   volatile size_t            tx_dma_current_len;
} tUartDmaModule;

/*---------------------------------------------------------------------------------------------------------------------
 *                                           VARIABLES DECLARATION
 *-------------------------------------------------------------------------------------------------------------------*/

/*---------------------------------------------------------------------------------------------------------------------
 *                                            FUNCTION DECLARATION
 *-------------------------------------------------------------------------------------------------------------------*/

void  uartDma_init (void);
void  uartDma_rx_check (void);
void  uartDma_process_data (const void* data, size_t len);
void  uartDma_send_string (const char* str, size_t len);
uint8_t uartDma_start_tx_dma_transfer(void);
void  uartDma_main (void);

#endif /* UARTDMA_H_ */
